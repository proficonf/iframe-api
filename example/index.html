<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>
        <%= htmlWebpackPlugin.options.title %>
    </title>
</head>

<body>
    <style>
        .flex-row {
            display: flex;
            justify-content: space-between;
            align-items:center;
            flex-flow: wrap;
            padding: 7px;
        }

        button, input {
            margin-top: 5px;
            margin-left: 5px;
            display: inline-block;
            padding: 5px;
        }
        button.active {
            background: #c4fdc4;
        }
    </style>
    <div id="initForm">
        <input 
            type="text"
            id="meetingUrl"
            placeholder="enter meetingUrl"
            value=""
        />
        <button id="joinBtn">Join</button>
    </div>

    <div class="buttons-container flex-row" id="screen" style="display: none">
        <div class="flex-row">
            <button id="enableCamera">EnableCamera</button>
            <button id="disableCamera">DisableCamera</button>

            <button id="enableMicrophone">EnableMicrophone</button>
            <button id="disableMicrophone">DisableMicrophone</button>

        </div>
        <div class="flex-row">
            <button class="toggleUiElement" data-toggle="disableLeftBar">Toggle leftbar</button>
            <button class="toggleUiElement" data-toggle="disableTopBar">Toggle topbar</button>
            <button class="toggleUiElement" data-toggle="disableChatbutton">Toggle chat button</button>
            <button class="toggleUiElement" data-toggle="disableSharingCenterButton">Toggle sharing center button</button>
            <button class="toggleUiElement" data-toggle="disableSharedFilesButton">Toggle shared files button</button>
            <button class="toggleUiElement" data-toggle="disableParticipantsListButton">Toggle participants button</button>
            <button class="toggleUiElement" data-toggle="disableDeviceControls">Toggle device controls</button>
            <button class="toggleUiElement" data-toggle="disableCameraControl">Toggle camera control</button>
            <button class="toggleUiElement" data-toggle="disableMicrophoneControl">Toggle microphone control</button>
            <button class="toggleUiElement" data-toggle="disableLeaveButton">Toggle leave button</button>
            <button class="toggleUiElement" data-toggle="disableMeetingName">Toggle meeting name</button>
            <button class="toggleUiElement" data-toggle="disableRoomLocker">Toggle room locker</button>
            <button class="toggleUiElement" data-toggle="disableTimer">Toggle timer</button>
            <button class="toggleUiElement" data-toggle="disableQualityIndicator">Toggle quality indicator</button>
            <button class="toggleUiElement" data-toggle="disableInviteButton">Toggle invite button</button>
            <button class="toggleUiElement" data-toggle="disableRecordingControl">Toggle recording control</button>
            <button class="toggleUiElement" data-toggle="disableStreamingControl">Toggle streaming control</button>
            <button class="toggleUiElement" data-toggle="disableDisplayModeButton">Toggle Display Mode button</button>
            <button class="toggleUiElement" data-toggle="disableConfigButton">Toggle config button</button>
            <button class="toggleUiElement" data-toggle="disableLogo">Toggle logo</button>
        </div>
        <div class="flex-row">
            <input type="color" id="primaryColor" name="primaryColor" />
            <label for="primaryColor">PrimaryColor</label>
        </div>
    </div>
    <div id="iframeWrapper"></div>

    <script type="text/javascript">
        let room;
        const userName = 'John Doe';
        const uiConfig = {
            disableLeftBar: false,
            disableTopBar: false,
            disableChatbutton: false,
            disableSharingCenterButton: false,
            disableSharedFilesButton: false,
            disableParticipantsListButton: false,
            disableDeviceControls: false,
            disableCameraControl: false,
            disableMicrophoneControl: false,
            disableLeaveButton: false,
            disableMeetingName: false,
            disableRoomLocker: false,
            disableTimer: false,
            disableQualityIndicator: false,
            disableInviteButton: false,
            disableRecordingControl: false,
            disableStreamingControl: false,
            disableDisplayModeButton: false,
            disableConfigButton: false,
            disableLogo: false,
            primaryColor: '#000000',
            logoSrc: 'https://github.githubassets.com/images/modules/logos_page/Octocat.png',
            displayMode: 'default'
        };

        async function initializeRoom(appOrigin, meetingId) {
            room = Proficonf.EmbeddedRoom.create({
                meetingId,
                appOrigin,
                rootElement: document.querySelector('div#iframeWrapper'),
                user: {
                    name: userName,
                    locale: 'en'
                },
                iframe: {
                    width: '100%',
                    height: '65vh',
                    style: {
                        border: '3px solid black',
                        backgroundColor: 'grey',
                        marginTop:'25px'
                    }
                },
                ui:uiConfig
            });

            room.on('*', (data) => {
                console.log('Event received', data);
            });

            await room.join();
        }


        (() => {

            document.querySelector('#joinBtn').addEventListener('click', () => {
                const meetingUrl = document.querySelector('#meetingUrl').value;

                const [origin, meetingId] = meetingUrl.split('/j/');
                document.querySelector('#initForm').style.display = 'none';
                

                initializeRoom(origin, meetingId.replace('/', '')).then(() =>{
                    document.querySelector('#screen').style.display = 'block';
                });
            });

            document.querySelector('#enableCamera').addEventListener('click', ()=>{
                room.enableCamera();
            });
            document.querySelector('#disableCamera').addEventListener('click', ()=>{
                room.disableCamera();
            });

            document.querySelector('#enableMicrophone').addEventListener('click', ()=>{
                room.enableMicrophone();
            });

            document.querySelector('#disableMicrophone').addEventListener('click', ()=>{
                room.disableMicrophone();
            });

            document.querySelector('#primaryColor').addEventListener('change', (event) =>{
                uiConfig.primaryColor = event.target.value;
                uiConfig.logoSrc = `https://i.pravatar.cc/150?u=${event.target.value.replace('#', 'x')}`;
                room.updateUIConfig(uiConfig);
            });

            document.querySelectorAll('.toggleUiElement').forEach(element =>{
                element.addEventListener('click', (event) =>{
                    event.preventDefault();
                    const configName = event.target.dataset.toggle;
                    uiConfig[configName] =  !uiConfig[configName];
                    event.target.innerText = configName + ': ' + uiConfig[configName];
                    if(uiConfig[configName]){
                        event.target.classList.add('active');
                    } else {
                        event.target.classList.remove('active');
                    }
                    
                    room.updateUIConfig(uiConfig);
                });
            })

            window.room = room;
            //http://host.docker.internal:8000/j/2AVT2rGmeT8/
        })();

    </script>
</body>

</html>